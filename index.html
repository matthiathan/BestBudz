        function updateNav() {
            if (!isLoggedIn) {
                document.getElementById('productsLink').classList.add('disabled');
                document.getElementById('cartLink').classList.add('disabled');
                document.getElementById('contactLink').classList.add('disabled');
            } else {
                document.getElementById('productsLink').classList.remove('disabled');
                document.getElementById('cartLink').classList.remove('disabled');
                document.getElementById('contactLink').classList.remove('disabled');
            }
        }

        function showPage(pageId) {
            if (!isLoggedIn && pageId !== 'home') {
                alert('Please login first');
                showAuth();
                return;
            }
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            if (pageId === 'products') loadProducts();
            if (pageId === 'cart') renderCart();
        }

        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(p => `
                <div class="product-card">
                    <img src="${p.img}" alt="${p.name}">
                    <h3 style="margin: 1rem 0;">${p.name}</h3>
                    <p style="font-size: 1.5rem; color: #28a745; font-weight: bold;">R ${p.price}</p>
                    <button onclick="addToCart(${p.id})">ðŸ›’ Add to Cart</button>
                </div>
            `).join('');
        }

        function addToCart(productId) {
            if (!isLoggedIn) {
                alert('Please login/register first');
                showAuth();
                return;
            }
            const product = products.find(p => p.id === productId);
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
            alert(`${product.name} added to cart!`);
        }

        function updateCart() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
            document.getElementById('cartCountSidebar').textContent = count;
            document.getElementById('cartSidebar').classList.toggle('hidden', count === 0);
            renderCartPreview();
        }

        function renderCartPreview() {
            const preview = document.getElementById('cartPreview');
            preview.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <span>${item.name} x${item.quantity}</span>
                    <div class="quantity-controls">
                        <button onclick="changeQuantity(${item.id}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="changeQuantity(${item.id}, 1)">+</button>
                    </div>
                    <button onclick="removeFromCart(${item.id})">Remove</button>
                </div>
            `).join('');
        }

        function changeQuantity(productId, delta) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCart();
                }
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
        }

        function renderCart() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartItems').innerHTML = cart.length ? 
                cart.map(item => `
                    <div class="cart-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>x${item.quantity}</small>
                        </div>
                        <div class="quantity-controls">
                            <button onclick="changeQuantity(${item.id}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="changeQuantity(${item.id}, 1)">+</button>
                        </div>
                        <div style="font-size:1.5rem;color:#28a745;">
                            R ${item.price * item.quantity}
                        </div>
                        <button onclick="removeFromCart(${item.id})">Remove</button>
                    </div>
                `).join('') + `<div style="border-top:1px solid #444;padding-top:2rem;margin-top:2rem;">
                    <h3 style="text-align:right;font-size:2rem;color:#28a745;">Total: R ${total}</h3>
                </div>` : 
                '<p style="text-align:center;font-size:1.5rem;padding:3rem;">Your cart is empty</p>';
        }

        function checkout() {
            if (!isLoggedIn || !currentUser) return alert('Please login first');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const message = `ðŸ›’ *NEW ORDER*\n\nðŸ‘¤ *Customer:* ${currentUser.name} ${currentUser.surname}\nðŸ“§ *Email:* ${currentUser.email}\nðŸ“± *Phone:* ${currentUser.phone}\nðŸ“ *Address:* ${currentUser.address}\n\nðŸ›ï¸ *ORDER DETAILS:*\n${cart.map(item => `â€¢ ${item.name} x${item.quantity} - R${item.price * item.quantity}`).join('\n')}\n\nðŸ’° *TOTAL: R${total}*\n\nâ° Order Time: ${new Date().toLocaleString('en-ZA')}`;
            
            window.open(`https://wa.me/27761533014?text=${encodeURIComponent(message)}`, '_blank');
            alert('âœ… Order sent to host via WhatsApp! Thank you!');
            cart = [];
            localStorage.setItem('cart', '[]');
            updateCart();
        }

        function showAuth() {
            document.getElementById('authForms').classList.remove('hidden');
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').textContent = isLoginMode ? 'Login' : 'Register';
            document.getElementById('name').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('surname').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('signupFields').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('authForm').onsubmit = isLoginMode ? handleLogin : handleSignup;
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if (email && password) {
                isLoggedIn = true;
                currentUser = { name: 'User', surname: 'Account', email, phone: '+27 76 153 3014' };
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                document.getElementById('authLink').textContent = 'Logout';
                document.getElementById('authLink').onclick = logout;
                closeAuth();
                updateNav();
                alert('âœ… Logged in successfully!');
                updateCart();
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const idNumber = document.getElementById('idNumber').value.replace(/\D/g, '');
            
            if (!/^\d{13}$/.test(idNumber)) return alert('âŒ Invalid ID format. Use YYMMDDXXXXXXX');
            
            const year = parseInt(idNumber.substring(0,2));
            const month = parseInt(idNumber.substring(2,4));
            const day = parseInt(idNumber.substring(4,6));
            const birthYear = year > 25 ? 1900 + year : 2000 + year;
            const birthDate = new Date(birthYear, month - 1, day);
            const age = new Date().getFullYear() - birthDate.getFullYear();
            const ageDiff = (Date.now() - birthDate.getTime()) / (365.25 * 24 * 60 * 60 * 1000);
            
            if (ageDiff < 18) return alert('âŒ You must be 18+ to register (Age: ' + Math.floor(ageDiff) + ')');
            
            currentUser = {
                name: document.getElementById('name').value,
                surname: document.getElementById('surname').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value
            };
            isLoggedIn = true;
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            document.getElementById('authLink').textContent = 'Logout';
            document.getElementById('authLink').onclick = logout;
            closeAuth();
            updateNav();
            alert('âœ… Registered successfully! Welcome aboard.');
        }

        function closeAuth() {
            document.getElementById('authForms').classList.add('hidden');
        }

        function logout() {
            isLoggedIn = false;
            currentUser = null;
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            document.getElementById('authLink').textContent = 'Login';
            document.getElementById('authLink').onclick = showAuth;
            updateNav();
            alert('ðŸ‘‹ Logged out successfully');
        }

        // Initialize
        document.getElementById('authForm').onsubmit = handleLogin;
        updateCart();
        updateNav();
    </script>
</body>
</html>
